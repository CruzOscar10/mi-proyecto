{% extends 'core/base.html' %}

{% block title %} Administrador - Restaurante El Paisa{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">
            <i class="fas fa-tachometer-alt"></i> Panel Principal - Administrador
        </h1>
        <p class="lead">Bienvenido, {{ user.first_name|default:user.username }}!</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-primary">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_pedidos|default:0 }}</h4>
                        <p class="card-text">Total Pedidos</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-shopping-cart fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-warning">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ pedidos_pendientes|default:0 }}</h4>
                        <p class="card-text">Pedidos Pendientes</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">${{ total_ventas|default:0 }}</h4>
                        <p class="card-text">Ventas Totales</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-dollar-sign fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h4 class="card-title">{{ total_clientes|default:0 }}</h4>
                        <p class="card-text">Total Clientes</p>
                    </div>
                    <div class="align-self-center">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-shopping-cart"></i> Pedidos Recientes
                </h5>
            </div>
            <div class="card-body">
                {% if pedidos_recientes %}
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Cliente</th>
                                <th>Fecha</th>
                                <th>Total</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pedido in pedidos_recientes %}
                            <tr>
                                <td>#{{ pedido.id }}</td>
                                <td>{{ pedido.cliente.username }}</td>
                                <td>{{ pedido.fecha_pedido|date:"d/m/Y H:i" }}</td>
                                <td>${{ pedido.total }}</td>
                                <td>
                                    <span class="badge bg-{% if pedido.estado == 'entregado' %}success{% elif pedido.estado == 'pendiente' %}warning{% else %}primary{% endif %}">
                                        {{ pedido.get_estado_display }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> No hay pedidos recientes.
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cogs"></i> Gestión del Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group">
                    <a href="{% url 'gestionar_menu' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-utensils me-2"></i> Gestionar Menú
                    </a>
                    <a href="{% url 'gestionar_personal' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-user-tie me-2"></i> Gestionar Personal
                    </a>
                    <a href="{% url 'gestionar_reservas' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-calendar-alt me-2"></i> Gestionar Reservas
                    </a>
                    <a href="{% url 'ver_comentarios' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-comments me-2"></i> Ver Comentarios
                    </a>
                    <a href="{% url 'generar_reporte' %}" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar me-2"></i> Generar Reportes
                    </a>
                    <a href="/django-admin/" class="list-group-item list-group-item-action">
                        <i class="fas fa-tools me-2"></i> Panel de Administración
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-rocket"></i> Acciones Rápidas
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'gestionar_menu' %}" class="btn btn-outline-primary">
                        <i class="fas fa-plus"></i> Agregar Producto
                    </a>
                    <a href="{% url 'gestionar_personal' %}" class="btn btn-outline-success">
                        <i class="fas fa-user-plus"></i> Agregar Personal
                    </a>
                    <a href="{% url 'gestionar_reservas' %}" class="btn btn-outline-warning">
                        <i class="fas fa-calendar-check"></i> Ver Reservas
                    </a>
                    <a href="/django-admin/" class="btn btn-outline-info">
                        <i class="fas fa-cog"></i> Panel Avanzado
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie"></i> Estadísticas del Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-user-tie fa-2x text-warning mb-2"></i>
                            <h4>{{ total_personal|default:0 }}</h4>
                            <small class="text-muted">Personal</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-utensils fa-2x text-success mb-2"></i>
                            <h4>{{ total_productos|default:0 }}</h4>
                            <small class="text-muted">Productos</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-comments fa-2x text-info mb-2"></i>
                            <h4>{{ total_comentarios|default:0 }}</h4>
                            <small class="text-muted">Comentarios</small>
                        </div>
                    </div>
                </div>
                <div class="row text-center">
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-calendar-alt fa-2x text-primary mb-2"></i>
                            <h4>{{ total_reservas|default:0 }}</h4>
                            <small class="text-muted">Reservas</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-star fa-2x text-warning mb-2"></i>
                            <h4>{{ promedio_calificacion|default:0 }}/5</h4>
                            <small class="text-muted">Calificación</small>
                        </div>
                    </div>
                    <div class="col-4">
                        <div class="mb-3">
                            <i class="fas fa-chart-line fa-2x text-success mb-2"></i>
                            <h4>{{ pedidos_hoy|default:0 }}</h4>
                            <small class="text-muted">Pedidos Hoy</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-bell"></i> Actividad Reciente
                </h5>
            </div>
            <div class="card-body">
                {% if pedidos_recientes or reservas_recientes %}
                <div class="activity-timeline">
                    {% for pedido in pedidos_recientes|slice:":3" %}
                    <div class="activity-item mb-3">
                        <div class="activity-badge bg-primary">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="activity-content">
                            <small class="text-muted">{{ pedido.fecha_pedido|timesince }} ago</small>
                            <p class="mb-0 small">Nuevo pedido #{{ pedido.id }} de {{ pedido.cliente.username }}</p>
                            <small class="text-muted">${{ pedido.total }} - {{ pedido.get_estado_display }}</small>
                        </div>
                    </div>
                    {% endfor %}
                    
                    {% for reserva in reservas_recientes|slice:":2" %}
                    <div class="activity-item mb-3">
                        <div class="activity-badge bg-warning">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="activity-content">
                            <small class="text-muted">{{ reserva.fecha_creacion|timesince }} ago</small>
                            <p class="mb-0 small">Nueva reserva #{{ reserva.id }} para {{ reserva.numero_personas }} personas</p>
                            <small class="text-muted">{{ reserva.fecha_reserva|date:"d/m H:i" }} - {{ reserva.get_estado_display }}</small>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                    <p class="text-muted">No hay actividad reciente</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-tachometer-alt"></i> Resumen de Estados
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                                <h5>{{ pedidos_pendientes|default:0 }}</h5>
                                <p class="mb-0">Pedidos Pendientes</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-utensils fa-2x text-primary mb-2"></i>
                                <h5>{{ pedidos_preparacion|default:0 }}</h5>
                                <p class="mb-0">En Preparación</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                <h5>{{ pedidos_entregados|default:0 }}</h5>
                                <p class="mb-0">Pedidos Entregados</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-calendar-check fa-2x text-info mb-2"></i>
                                <h5>{{ reservas_confirmadas|default:0 }}</h5>
                                <p class="mb-0">Reservas Confirmadas</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<style>
.activity-timeline {
    position: relative;
    padding-left: 40px;
}
.activity-item {
    position: relative;
}
.activity-badge {
    position: absolute;
    left: -40px;
    top: 0;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
}
.activity-content {
    margin-left: 10px;
}
</style>
{% endblock %}